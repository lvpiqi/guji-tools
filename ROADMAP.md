# 古籍工具集 · 开发路线图

> 按技术依赖关系和用户价值排序，建议按此顺序开发

---

## 开发进度总览

| 阶段 | 状态 | 完成工具 |
|-----|------|---------|
| 第一阶段 | ✅ 完成 | 自动纠偏、背景统一、双层PDF |
| 第二阶段 | ✅ 完成 | 竖排OCR、自动句读、繁简转换 |
| 第三阶段 | ✅ 完成 | 蠹鱼眼修复、印章提取、AI超分 |
| 第四阶段 | ✅ 完成 | 竖横排转换、划词释义、古文朗读 |
| 第五阶段 | ✅ 完成 | 异体字搜索、版本对比 |
| 第六阶段 | ✅ 完成 | 字形演变、押韵检测、古画色卡 |
| 导出增强 | ✅ 完成 | EPUB生成、长图生成 |

---

## 第一阶段：基础能力 (第1-2月) ✅ 已完成

### 1.1 自动纠偏裁边 ⭐ 首选
**路径**: `src/tools/input/Deskew.vue`

**为什么先做**:
- 技术最简单，OpenCV-wasm 成熟稳定
- 用户需求最高频（几乎每张扫描件都需要）
- 为后续 OCR 提供干净输入

**技术方案**:
```
依赖: opencv.js (约4MB)
算法: Hough变换检测边缘 → 透视变换矫正 → 自动裁切白边
```

**核心代码逻辑**:
1. 灰度化 + 高斯模糊
2. Canny 边缘检测
3. findContours 找最大轮廓
4. approxPolyDP 拟合四边形
5. getPerspectiveTransform + warpPerspective 矫正

**预计工时**: 3-5天

---

### 1.2 背景统一/匀光 
**路径**: `src/tools/clean/BackgroundUnify.vue` (新建)

**为什么第二**:
- 纯 Canvas 实现，无需额外 WASM
- 解决扫描光照不均问题
- 为 OCR 提升识别率

**技术方案**:
```
依赖: 无 (纯Canvas)
算法: 形态学开运算提取背景 → 原图/背景 得到均匀图
```

**预计工时**: 2-3天

---

### 1.3 双层PDF导出
**路径**: `src/tools/export/DualLayerPdf.vue`

**为什么第三**:
- pdf-lib 纯 JS，体积小
- 用户强需求（可搜索PDF）
- 为后续 OCR 工具提供导出能力

**技术方案**:
```
依赖: pdf-lib (~300KB)
流程: 图像作为背景 + 透明文字层叠加
```

**预计工时**: 3-4天

---

## 第二阶段：OCR核心 (第3-4月) ✅ 已完成

### 2.1 竖排OCR识别
**路径**: `src/tools/input/OcrVertical.vue`

**技术方案**:
```
方案A: Tesseract.js + 竖排训练数据 (简单但精度一般)
方案B: PaddleOCR-wasm (精度高但体积大)
方案C: 调用云端API (精度最高，有成本)
```

**建议**: 先用 Tesseract.js 快速上线，后续迭代升级

**预计工时**: 5-7天

---

### 2.2 自动句读
**路径**: `src/tools/input/Punctuation.vue`

**技术方案**:
```
方案A: 调用"吾与点"API (推荐，精度高)
方案B: 本地规则引擎 (离线可用但精度低)
方案C: 古文BERT模型 (需要后端)
```

**预计工时**: 3-5天

---

### 2.3 繁简转换
**路径**: `src/tools/input/TraditionalSimplified.vue` (新建)

**技术方案**:
```
依赖: OpenCC-js (~200KB)
特性: 支持异体字选择、地区词转换
```

**预计工时**: 2-3天

---

## 第三阶段：图像修复 (第5-6月) ✅ 已完成

### 3.1 蠹鱼眼/墨点修复
**路径**: `src/tools/clean/Inpaint.vue`

**技术方案**:
```
依赖: lama-cleaner-wasm 或 opencv inpaint
流程: 用户画mask → AI填充
```

**预计工时**: 5-7天

---

### 3.2 AI超分辨率
**路径**: `src/tools/clean/SuperResolution.vue`

**技术方案**:
```
依赖: Real-ESRGAN-wasm (~10MB)
支持: 2x/4x 放大
```

**预计工时**: 4-5天

---

### 3.3 去手指阴影
**路径**: `src/tools/input/RemoveFinger.vue`

**技术方案**:
```
依赖: MediaPipe Hands + LaMa inpainting
流程: 检测手部区域 → 自动生成mask → inpaint填充
```

**预计工时**: 5-7天

---

## 第四阶段：阅读体验 (第7-8月) ✅ 已完成

### 4.1 竖横排转换
**路径**: `src/tools/read/VerticalHorizontal.vue`

**技术方案**:
```
依赖: 无 (CSS writing-mode)
难点: 保持阅读顺序正确
```

**预计工时**: 2-3天

---

### 4.2 划词释义
**路径**: `src/tools/read/Dictionary.vue`

**技术方案**:
```
依赖: 汉典API / 本地词典数据
功能: 悬停显示释义、现代文、英文
```

**预计工时**: 4-5天

---

### 4.3 流式EPUB生成
**路径**: `src/tools/export/Epub.vue`

**技术方案**:
```
依赖: epub-gen-memory 或手动构建
功能: 自适应手机/Kindle
```

**预计工时**: 4-5天

---

## 第五阶段：搜索与对比 (第9-10月) ✅ 已完成

### 5.1 异体字搜索
**路径**: `src/tools/search/VariantSearch.vue`

**技术方案**:
```
依赖: 异体字对照表 (Unicode IVD + 自建)
功能: 输入一字，扩展搜索所有异体
```

**预计工时**: 3-4天

---

### 5.2 版本对比
**路径**: `src/tools/search/DiffCompare.vue`

**技术方案**:
```
依赖: diff-match-patch
功能: 两版本文字差异高亮
```

**预计工时**: 3-4天

---

### 5.3 印章提取
**路径**: `src/tools/clean/ExtractSeal.vue`

**技术方案**:
```
依赖: 无 (Canvas颜色聚类)
算法: HSV色彩空间提取红色区域 → 透明PNG
```

**预计工时**: 2-3天

---

## 第六阶段：专业工具 (第11-12月) ✅ 已完成

### 6.1 字形演变动画
**路径**: `src/tools/pro/GlyphEvolution.vue`

**技术方案**:
```
依赖: 字形数据库 (甲骨文→金文→篆→隶→楷)
功能: 输入汉字 → 生成演变GIF
```

**预计工时**: 5-7天

---

### 6.2 押韵检测
**路径**: `src/tools/pro/RhymeCheck.vue`

**技术方案**:
```
依赖: 广韵/平水韵数据库
功能: 检测诗词韵部、标记出韵
```

**预计工时**: 3-4天

---

### 6.3 古画色卡
**路径**: `src/tools/pro/ColorPalette.vue`

**技术方案**:
```
依赖: 中国传统色名数据库
算法: 图像量化 → 匹配最近传统色名
```

**预计工时**: 3-4天

---

## 技术依赖总览

| WASM模块 | 体积 | 用于工具 | 优先级 |
|---------|------|---------|-------|
| opencv.js | ~4MB | 纠偏、修复、印章 | P0 |
| pdf-lib | ~300KB | 双层PDF | P0 |
| tesseract.js | ~2MB | OCR | P1 |
| opencc-js | ~200KB | 繁简转换 | P1 |
| lama-wasm | ~15MB | 去手指、修复 | P2 |
| real-esrgan | ~10MB | 超分 | P2 |

---

## 每月里程碑

| 月份 | 目标 | 核心交付 | 状态 |
|-----|------|---------|------|
| 1月 | 基础能力 | 纠偏 + 匀光 | ✅ |
| 2月 | 导出能力 | 双层PDF | ✅ |
| 3月 | OCR上线 | 竖排识别 | ✅ |
| 4月 | OCR增强 | 句读 + 繁简 | ✅ |
| 5月 | 图像修复 | 蠹鱼眼修复 | ✅ |
| 6月 | 修复增强 | 超分 + 印章提取 | ✅ |
| 7月 | 阅读体验 | 竖横排 + 释义 | ✅ |
| 8月 | 导出增强 | EPUB + 长图 | ✅ |
| 9月 | 搜索能力 | 异体字搜索 | ✅ |
| 10月 | 对比工具 | 版本对比 | ✅ |
| 11月 | 专业工具 | 字形演变 | ✅ |
| 12月 | 专业完善 | 押韵 + 色卡 | ✅ |

---

## 开发建议

1. **先跑通再优化** - 每个工具先用最简单方案上线，收集反馈后迭代
2. **共享组件优先** - 发现重复逻辑立即抽取到 `core/composables`
3. **WASM懒加载** - 大模块用到时才下载，避免首屏卡顿
4. **移动端适配** - 每个工具完成后立即测试手机端
5. **埋点统计** - 记录每个工具使用量，指导优先级调整

---

## 下一步行动

### 已完成的工具 (18个)

**输入场景:**
- ✅ 自动纠偏 (OpenCV Web Worker)
- ✅ 竖排OCR (Tesseract.js)
- ✅ 自动句读 (规则引擎)
- ✅ 繁简转换 (OpenCC-js)
- 🚧 去手指阴影 (占位，待接入MediaPipe)

**清理场景:**
- ✅ 背景统一/匀光 (Canvas)
- ✅ 蠹鱼眼修复 (Canvas Inpaint)
- ✅ AI超分 (Canvas双线性插值)
- ✅ 印章提取 (HSV颜色检测)

**阅读场景:**
- ✅ 竖横排转换 (CSS writing-mode)
- ✅ 划词释义 (本地词典)
- ✅ 古文朗读 (Web Speech API)

**搜索场景:**
- ✅ 异体字搜索 (异体字映射表)
- ✅ 版本对比 (LCS diff算法)

**输出场景:**
- ✅ 双层PDF (pdf-lib)
- ✅ EPUB生成 (JSZip)
- ✅ 长图生成 (Canvas拼接)

**专业场景:**
- ✅ 字形演变 (字形数据库)
- ✅ 押韵检测 (平水韵数据)
- ✅ 古画色卡 (颜色量化+传统色名)

### 后续优化方向

1. **去手指阴影** - 接入 MediaPipe Hands + LaMa inpainting
2. **AI超分增强** - 接入 Real-ESRGAN WASM 提升效果
3. **OCR精度提升** - 考虑接入 PaddleOCR 或云端API
4. **移动端适配** - 优化触屏交互体验
5. **性能优化** - 大图分块处理，避免内存溢出

祝开发顺利！🚀
